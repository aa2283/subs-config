- name: å¯åŠ¨å®¹å™¨ä¸åŒéš§é“æ˜ å°„
        run: |
          # 1. å‡†å¤‡ç¯å¢ƒ
          mkdir -p ${{ github.workspace }}/temp_config
          mkdir -p ${{ github.workspace }}/output
          
          # 2. é¢„ç½®æœ€åŸºç¡€çš„é…ç½®æ–‡ä»¶ï¼ˆç¡®ä¿æŠ¤èˆªï¼‰
          cat <<EOF > ${{ github.workspace }}/temp_config/config.yaml
          server:
            port: 8199
            addr: 0.0.0.0
            web-control: true
          EOF
          
          sudo chmod -R 777 ${{ github.workspace }}/temp_config
          sudo chmod -R 777 ${{ github.workspace }}/output

          # 3. å¯åŠ¨å®¹å™¨ (ä½¿ç”¨ host æ¨¡å¼ç¡®ä¿ cloudflared èƒ½ç©¿é€)
          echo "ğŸš€ æ­£åœ¨å¯åŠ¨é›†æˆé•œåƒ..."
          docker run --name checker -d \
            --network host \
            -v ${{ github.workspace }}/temp_config:/app/config \
            -v ${{ github.workspace }}/output:/app/output \
            ghcr.io/aa2283/subs-check:master

          # 4. ç«¯å£æ•æ‰ (ç­‰å¾…ç›´åˆ° 8199 æˆ– 8299 çœŸæ­£å“åº”)
          echo "ğŸ” æ­£åœ¨æ•æ‰ç«¯å£å“åº”çŠ¶æ€..."
          for i in {1..30}; do
            if curl -s http://localhost:8199 > /dev/null || curl -s http://localhost:8299 > /dev/null; then
              echo "âœ… æœåŠ¡å·²å‘ç°ï¼"
              break
            fi
            echo "æ•æ‰ä¸­... ($i/30)"
            sleep 3
          done

          # 5. ç”³è¯·åŒéš§é“
          curl -L https://github.com/cloudflare/cloudflared/releases/latest/download/cloudflared-linux-amd64 -o cloudflared
          chmod +x cloudflared
          
          echo "ğŸŒ æ­£åœ¨ç”³è¯· Cloudflare éš§é“..."
          nohup ./cloudflared tunnel --url http://localhost:8199 --logfile tunnel_8199.log > /dev/null 2>&1 &
          nohup ./cloudflared tunnel --url http://localhost:8299 --logfile tunnel_8299.log > /dev/null 2>&1 &
          
          # ç»™ç‚¹æ—¶é—´è®©éš§é“æ¡æ‰‹
          sleep 12

          # 6. æå–å¹¶å±•ç¤ºé“¾æ¥
          LINK_8199=$(grep -oE 'https://[-0-9a-z]*\.trycloudflare\.com' tunnel_8199.log | head -n 1)
          LINK_8299=$(grep -oE 'https://[-0-9a-z]*\.trycloudflare\.com' tunnel_8299.log | head -n 1)

          echo "------------------------------------------------"
          if [ -n "$LINK_8199" ]; then
            echo "ğŸ”— éš§é“ A (8199): $LINK_8199/admin"
            echo "ğŸ”— å¤‡ç”¨ A (8199): $LINK_8199/"
          fi
          if [ -n "$LINK_8299" ]; then
            echo "ğŸ”— éš§é“ B (8299): $LINK_8299/admin"
            echo "ğŸ”— å¤‡ç”¨ B (8299): $LINK_8299/"
          fi
          echo "------------------------------------------------"
          
          # æŸ¥çœ‹å®¹å™¨å®æ—¶æ—¥å¿—ï¼Œæ–¹ä¾¿ä½ è°ƒè¯• 404
          echo "ğŸ“‹ å®¹å™¨å½“å‰å¯åŠ¨æ—¥å¿—æ‘˜è¦ï¼š"
          docker logs --tail 20 checker

          # 7. æŒ‚æœºä¿æ´» 15 åˆ†é’Ÿ
          for i in {15..1}; do
            echo "â³ éš§é“å­˜æ´»å€’è®¡æ—¶: $i åˆ†é’Ÿ..."
            sleep 60
          done
