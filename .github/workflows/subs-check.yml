- name: Run subscription checker
        run: |
          mkdir -p ${{ github.workspace }}/output
          (
            echo ">>> 极速监听器启动..."
            while true; do
              sleep 1
              # 精简版下，我们只盯着 all.yaml 的生成
              if docker logs checker 2>&1 | grep -q "保存本地成功 filepath=/app/output/all.yaml"; then
                echo -e "\n[监听器] sub.yaml 已就绪，准备收工..."
                docker stop checker
                break
              fi
              if ! docker ps | grep -q "checker"; then break; fi
            done
          ) &

          echo ">>> 启动轻量化检测引擎..."
          docker run --name checker --rm \
            -v ${{ github.workspace }}/config:/app/config \
            -v ${{ github.workspace }}/output:/app/output \
            -e SUB_URLS="${{ secrets.SUB_URLS }}" \
            ghcr.io/aa2283/subs-check:master
